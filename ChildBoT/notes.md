- Used this to get the IP address of the local host machine
```
IPAddress[] hostAddresses = Dns.GetHostAddresses(Dns.GetHostName());
```

```
AddressFamily.InterNetwork; represents the use of IPv4 address family of network IP adresses.
```

- The below program can be used to get various network info of a local host machine:
```
using System;
using System.Management;
using System.Net;
using System.Net.Sockets;

namespace HttpRequest
{
	// Token: 0x0200000F RID: 15
	public static class ClientInfo
	{
		// Token: 0x06000045 RID: 69
		public static string GetPublicIPAddress()
		{
			return new WebClient().DownloadString("http://icanhazip.com");
		}

		// Token: 0x06000046 RID: 70 RVA: 0x00003E3C File Offset: 0x0000203C
		public static string GetStaticIPAddress()
		{
			IPAddress[] hostAddresses = Dns.GetHostAddresses(Dns.GetHostName());
			foreach (IPAddress ipaddress in hostAddresses)
			{
				bool flag = ipaddress.AddressFamily == AddressFamily.InterNetwork;
				if (flag)
				{
					return ipaddress.ToString();
				}
			}
			return null;
		}

		// Token: 0x06000047 RID: 71 RVA: 0x00003EA4 File Offset: 0x000020A4
		public static string GetModelNumber()
		{
			ManagementObjectSearcher managementObjectSearcher = new ManagementObjectSearcher("SELECT * FROM Win32_DiskDrive");
			HardDrive hardDrive = new HardDrive();
			foreach (ManagementBaseObject managementBaseObject in managementObjectSearcher.Get())
			{
				ManagementObject managementObject = (ManagementObject)managementBaseObject;
				hardDrive.Model = managementObject["Model"].ToString();
			}
			return hardDrive.Model;
		}

		// Token: 0x06000048 RID: 72 RVA: 0x00003F34 File Offset: 0x00002134
		public static string GetVolumeSerial(string strDriveLetter)
		{
			bool flag = strDriveLetter == "" || strDriveLetter == null;
			if (flag)
			{
				strDriveLetter = "C";
			}
			ManagementObject managementObject = new ManagementObject("win32_logicaldisk.deviceid=\"" + strDriveLetter + ":\"");
			managementObject.Get();
			return managementObject["VolumeSerialNumber"].ToString();
		}

		// Token: 0x06000049 RID: 73 RVA: 0x00003FA4 File Offset: 0x000021A4
		public static string GetSerialNumber()
		{
			ManagementObjectSearcher managementObjectSearcher = new ManagementObjectSearcher("SELECT * FROM Win32_DiskDrive");
			HardDrive hardDrive = new HardDrive();
			foreach (ManagementBaseObject managementBaseObject in managementObjectSearcher.Get())
			{
				ManagementObject managementObject = (ManagementObject)managementBaseObject;
				hardDrive.SerialNo = managementObject["SerialNumber"].ToString();
			}
			return hardDrive.SerialNo;
		}

		// Token: 0x0600004A RID: 74 RVA: 0x00004034 File Offset: 0x00002234
		public static string GetMACAddress()
		{
			ManagementClass managementClass = new ManagementClass("Win32_NetworkAdapterConfiguration");
			ManagementObjectCollection instances = managementClass.GetInstances();
			string text = string.Empty;
			foreach (ManagementBaseObject managementBaseObject in instances)
			{
				ManagementObject managementObject = (ManagementObject)managementBaseObject;
				bool flag = text == string.Empty;
				if (flag)
				{
					bool flag2 = (bool)managementObject["IPEnabled"];
					if (flag2)
					{
						text = managementObject["MacAddress"].ToString();
					}
				}
				managementObject.Dispose();
			}
			text = text.Replace(":", "");
			return text;
		}
	}
}
```

- This will change the OS actions when it has to access the web or any network.

```
SOFTWARE\WOW6432Node\Clients\StartMenuInternet
SOFTWARE\Clients\StartMenuInternet
```
- This converts the bytes to hex strings with 2 hex chars each.
```
foreach (byte b in array)
	{
		stringBuilder.Append(b.ToString("x2"));
	}
```
- method1 returns b5c3479be2083c99ca85
- fn_settings_xml returns a random obfuscated string concatenated to "settings.xml"

- This string is being hunted by the malware inside the xml documents.

```
 "„ÅÇ‡πÉ„ÅØ„Åï„Åæ„ÇÜ„Åï‡∏õ„ÅÇ„Çä„Å≠„Å≤„ÇÄ„Çà„Å®„Çà‡∏É‡∏¢„Å≠‡∏õ„ÇÄ"
```

```
SelectSingleNode is a method provided by the XPathNavigator class in the .NET Framework. It is used to select the first XML node that matches the specified XPath expression.
```

- fn_dir_trav_setting returns the path of the created directory inside the xml or mp registry keys section.

- the malware is creating a directory named 'installedChildBot'.

- set_HWIDFromChildBot function sets the Handlw of the Window of the ChildBot created or installed.

- It also sets the Telegram Chat ID and Telegram Token via the same process.

- Environment.GetEnvironmentVariable(var) it gets the path of that variable "var".

- GET Request made for 60 seconds

```
requestHTTP.Request(Encoding.UTF8.GetString(Convert.FromBase64String("R0VU")), Encoding.UTF8.GetString(Convert.FromBase64String("aHR0cDovL2lwaW5mby5pby9pcA==")), null, null, true, null, 60000)
```
- This will get the raw data in continuous format from the server.

```
result = text.Replace("\\r\\n", "").Replace("\\n", "").Trim();
```

- Uses SQL queries to get the info about the AV
```
using (ManagementObjectSearcher managementObjectSearcher2 = new ManagementObjectSearcher("\\\\" + Environment.MachineName + "\\root\\SecurityCenter2", "SELECT * FROM AntivirusProduct"))
```
- It wants to exploit the management resources for Screen Display from the Windows Management Instrumentation.

```
ManagementObjectSearcher managementObjectSearcher = new ManagementObjectSearcher("root\\WMI", "SELECT * FROM WmiMonitorBasicDisplayParams");
```
- <b> fn_resolve_keyboard tries to run this query.
```
Select * from Win32_Keyboard
```

- Makes the window hidden and not even show it on the taskbar

- It is spawning this string inside the AV detection directory process
```
üõ° AV: üö´ NO - Maybe SANBOX!
```

- Then it gives these strings to most probably tell the attacker about his options.
```
üñ• Monitor Physical: ‚úÖ YES!
‚å®Ô∏è Keybroad Physical: üö´ NO!
üö´ RAM < 4GB!
üö´ DISK SYSTEM < 128GB!
üö´ WEB BROWSER: NO
‚õîÔ∏è DETECT VM,SANBOX: 
To continue please write the content: [HWID]-SKIP VM Or ‚ùå Exit  :[HWID]-EXIT
We are still active until victime shuts down!
 - Maybe VM,Sanbox
 LUVYSVQ=
 ‚ùåEXIT SUCCESS
```
- This also tells us that there is persistence added in the malware.


- It tries to find these strings into the registry keys in order to modify them.

```
Microsoft Edge
IEXPLORE.EXE
```

- It is trying to download a telegram bot
```
 üëâ START DOWNLOADING MAIN BOT  üëª
 üëâ START LOAD DLL MainBot  üëª
```

```
result
channel_post
id
text
```





